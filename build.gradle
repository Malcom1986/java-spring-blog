plugins {
  id 'java'
  id 'checkstyle'
  id 'org.springframework.boot' version '2.5.3'
  id 'io.spring.dependency-management' version '1.0.11.RELEASE'
  id 'com.adarshr.test-logger' version '2.1.1'
  id 'com.github.ben-manes.versions' version '0.38.0'
}

group = 'io.hexlet'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '16'

configurations {
  compileOnly {
    extendsFrom annotationProcessor
  }
  checkstyleConfig
}

repositories {
  mavenCentral()
}

ext {
  checkstyleVersion = '9.0'
}

afterEvaluate {
  checkstyle {
    toolVersion = project.ext.checkstyleVersion
    // https://github.com/square/okhttp/pull/5720/files
    config resources.text.fromArchiveEntry(configurations.checkstyleConfig, 'google_checks.xml')
  }
}

dependencies {
  checkstyleConfig dependencies.create("com.puppycrawl.tools:checkstyle:${project.ext.checkstyleVersion}") {
    transitive = false
  }

  developmentOnly 'org.springframework.boot:spring-boot-devtools:2.5.5'
  implementation 'org.springframework.boot:spring-boot-starter-data-jpa:2.5.5'
  implementation 'org.springframework.boot:spring-boot-starter-web:2.5.5'
  implementation 'org.springframework.boot:spring-boot-starter-actuator:2.5.5'
  implementation 'org.springframework.boot:spring-boot-starter-thymeleaf:2.5.5'
  implementation 'org.springframework.boot:spring-boot-starter-validation:2.5.5'
  implementation 'org.springframework.boot:spring-boot-starter-security:2.5.5'
  runtimeOnly 'org.postgresql:postgresql:42.2.24.jre7'

  compileOnly 'org.projectlombok:lombok:1.18.22'
  annotationProcessor 'org.projectlombok:lombok:1.18.22'

  testImplementation 'org.springframework.security:spring-security-test:2.5.5'
  testImplementation 'org.springframework.boot:spring-boot-starter-test:2.5.5'
  testImplementation 'com.tobedevoured.modelcitizen:spring:0.8.3'
  testRuntimeOnly 'com.h2database:h2:1.4.200'
}

test {
  useJUnitPlatform()
}

tasks.named('wrapper') {
  gradleVersion = '7.2'
  distributionType = Wrapper.DistributionType.ALL
}
