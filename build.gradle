plugins {
  id 'org.springframework.boot' version '2.5.3'
  id 'io.spring.dependency-management' version '1.0.11.RELEASE'
  id 'java'
  id 'com.adarshr.test-logger' version '2.1.1'
  id 'checkstyle'
  id 'com.github.ben-manes.versions' version '0.38.0'
}

group = 'io.hexlet'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '16'

configurations {
  compileOnly {
    extendsFrom annotationProcessor
  }
  checkstyleConfig
}

repositories {
  mavenCentral()
}

ext {
  checkstyleVersion = '8.41'
}

afterEvaluate {
  checkstyle {
    toolVersion project.ext.checkstyleVersion
    // https://github.com/square/okhttp/pull/5720/files
    config resources.text.fromArchiveEntry(configurations.checkstyleConfig, 'google_checks.xml')
  }
}

dependencies {
  checkstyleConfig dependencies.create("com.puppycrawl.tools:checkstyle:${project.ext.checkstyleVersion}") {
    transitive = false
  }

  developmentOnly 'org.springframework.boot:spring-boot-devtools'
  implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
  implementation 'org.springframework.boot:spring-boot-starter-web'
  implementation 'org.springframework.boot:spring-boot-starter-actuator'
  implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
  implementation 'org.springframework.boot:spring-boot-starter-validation'
  runtimeOnly 'org.postgresql:postgresql'

  compileOnly 'org.projectlombok:lombok'
  annotationProcessor 'org.projectlombok:lombok'

  testImplementation 'org.springframework.boot:spring-boot-starter-test'
  testImplementation 'com.tobedevoured.modelcitizen:spring:0.8.3'
  testRuntimeOnly 'com.h2database:h2'
}

test {
  useJUnitPlatform()
}

tasks.named('wrapper') {
  gradleVersion = '7.1.1'
  distributionType = Wrapper.DistributionType.ALL
}
